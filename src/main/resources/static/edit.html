<!DOCTYPE html>
<html>
<head>
    <title>Edit Entry</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="js/api.js"></script>
</head>

<body class="bg-light">
<div class="container mt-4">

    <h2>Edit Entry</h2>

    <form id="searchForm">
        <label>ID:</label>
        <input type="number" id="searchId" class="form-control">
        <button class="btn btn-warning mt-3">Fetch</button>
    </form>

    <div id="editSection" class="mt-4" style="display:none;">

        <label>Name:</label>
        <input type="text" id="editName" class="form-control">

        <label>Percentage:</label>
        <input type="number" step="0.01" id="editPercentage" class="form-control">

        <label>Married?</label>
        <input type="checkbox" id="editMarried">

        <button id="updateBtn" class="btn btn-success mt-3">Update</button>
    </div>

    <div id="result" class="mt-3"></div>

</div>

<script>
    let currentId = 0;
    const resultDiv = document.getElementById("result");
    const editSection = document.getElementById("editSection");

    document.getElementById("searchForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        currentId = document.getElementById("searchId").value;

        try {
            // Reset UI
            resultDiv.innerHTML = "";
            editSection.style.display = "none";

            const u = await getEntryById(currentId);

            // Populate form
            editSection.style.display = "block";
            document.getElementById("editName").value = u.name;
            document.getElementById("editPercentage").value = u.percentage;
            document.getElementById("editMarried").checked = u.married; // Fixed: using u.married matching API

        } catch (error) {
            resultDiv.innerHTML = `<div class='alert alert-danger'>${error.message}</div>`;
        }
    });

    document.getElementById("updateBtn").addEventListener("click", async () => {
        try {
            const updatedUser = {
                name: document.getElementById("editName").value,
                percentage: parseFloat(document.getElementById("editPercentage").value),
                married: document.getElementById("editMarried").checked // Fixed: property name
            };

            await updateEntry(currentId, updatedUser);
            resultDiv.innerHTML = `<div class='alert alert-success'>Updated Successfully</div>`;

        } catch (error) {
            resultDiv.innerHTML = `<div class='alert alert-danger'>${error.message}</div>`;
        }
    });
</script>

</body>
</html>
